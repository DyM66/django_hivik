<!-- dth/payroll_list.html -->
{% extends 'base/base_generic.html' %}

{% block title %}Gestión de nomina{% endblock %}
{% block headtag %}
<style>
    .card-nomina {
        width: 18rem;
        margin: 0.5rem;
    }
    /* Modal de pantalla completa (opcional) */
    .modal-fullscreen {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        max-width: 100% !important;
    }
</style>
{% endblock %}
{% block content %}
<div class="container py-4">
    <h1 class="mb-4">Gestión de Nomina</h1>
    
    <div class="row">
        {% for nomina in nominas %}
            <div class="col-sm-6 col-md-4 col-lg-3 d-flex">
                <div class="card card-nomina">
                    <img class="card-img-top" src="{{ nomina.photo_url }}" alt="Foto de {{ nomina.name }}">
                    <div class="card-body">
                        <h5 class="card-title">{{ nomina.name }} {{ nomina.surname }}</h5>
                        <p class="card-text">{{ nomina.position }}</p>
                        <p class="card-text text-muted" style="font-size: 0.9em;">
                            Ingreso: {{ nomina.admission|date:"d/m/Y" }}
                        </p>
                        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#nominaDetailModal" data-nomina-id="{{ nomina.id }}">
                            Ver detalle
                        </button>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>
  
<!-- Modal (pantalla completa opcional) -->
<div class="modal fade" id="nominaDetailModal" tabindex="-1" aria-labelledby="nominaDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-fullscreen">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="nominaDetailModalLabel">Detalle del Empleado</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <!-- Aquí cargaremos dinámicamente la info del empleado -->
                <div id="modalDetailContent">
                    <p>Cargando...</p>
                </div>
            </div>
        </div>
    </div>
</div>
  
  {% comment %} <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script> {% endcomment %}
<script>
    // Escuchamos el evento de click en el botón "Ver detalle"
    const detailModal = document.getElementById('nominaDetailModal');
    detailModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        const nominaId = button.getAttribute('data-nomina-id');
        const modalBody = document.getElementById('modalDetailContent');
        
        // Puedes hacer una petición AJAX o fetch a una URL que te devuelva
        // el HTML detallado. Para simplificar, metemos un ejemplo "mock".
        // En un proyecto real, implementarías un endpoint que devuelva 
        // el detalle en formato HTML o JSON.
      
        modalBody.innerHTML = "<p>Cargando la información de la persona...</p>";
        
        fetch(`/dth/api/nomina/${nominaId}/detail/`)
            .then(response => response.text())
            .then(html => {
            modalBody.innerHTML = html;
            })
            .catch(error => {
            modalBody.innerHTML = `<p>Error al cargar detalle: ${error}</p>`;
        });
    });
</script>
{% endblock %}