{% extends "got/base_generic.html" %}
{% load my_tags %}

{% block header %}

    {% if perms.got.view_asset %}
        <a href="{% url 'got:failure-report-list' %}"><i class="bi bi-arrow-90deg-left"></i></a>
    {% endif %}
    Reporte de falla #{{ failurereport.id }}
    <hr>

{% endblock %}

{% block content %}
    
    <a href="{% url 'got:failure-report-update' failurereport.id %}" class="btn btn-danger"><i class="bi bi-pen"></i></a>
    {% if not failurereport.related_ot %}
        <a href="{% url 'got:failure-report-crear-ot' failurereport.id %}" class="btn btn-success">Generar orden de trabajo</a>
    {% else %}
        <a href="{% url 'got:ot-detail' failurereport.related_ot.num_ot %}" class="btn btn-primary">
            Orden de trabajo: OT-{{ failurereport.related_ot.num_ot }}
        </a>
    {% endif %}
    <a href="{% url 'got:fail_pdf' failurereport.id %}" class="btn btn-primary">Generar reporte</a>


<!-- Informacion basica -->
<table class="table">
    <tbody>
        <tr>
            <th>Fecha: </th>
            <td>{{ failurereport.moment }}</td>
        </tr>
        <tr>
            <th>Persona que reporta la falla: </th>
            <td>{{ failurereport.reporter.first_name }} {{ failurereport.reporter.last_name }}</td>
        </tr>
        <tr>
            <th>Estado: </th>
            <td>{% if failurereport.closed %}Cerrado{% else %}Abierto{% endif %}</td>
        </tr>
        <tr>
            <th>Sistema: </th>
            <td>{{ failurereport.equipo.system.asset.name }}</td>
        </tr>
        <tr>
            <th>Equipo: </th>
            <td>{{ failurereport.equipo.name }}</td>
        </tr>     
        <tr>
            <th>Descripción detallada de la falla: </th>
            <td>{{ failurereport.description }}</td>
        </tr>
        <tr>
            <th>Analisis de causas: </th>
            <td>{{ failurereport.causas }}</td>
        </tr>
        <tr>
            <th>Reparación sugerida: </th>
            <td>{{ failurereport.suggest_repair }}</td>
        </tr>
        <tr>
            <th>Impacto: </th>
            <td>
                {% for impact_code in failurereport.impact %}
                    {{ impact_code|get_impact_display }}{% if not forloop.last %},{% else %}.{% endif %}
                {% empty %}
                    No se especificó impacto.
                {% endfor %}
            </td>
        </tr>
        <tr>
            <th colspan="2">Evidencias: </th>
        </tr>
        {% for i in failurereport.images.all %}
            <tr>
                <td><img src="{{ i.image.url }}" width=200></td>
            </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}