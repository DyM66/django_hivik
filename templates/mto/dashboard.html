{% extends "got/base/base_generic.html" %}
{% load my_tags %}
{% block content %}
<style>
	.dashboard-container {
		margin: 20px;
	}
	.dashboard-columns {
		display: flex;
		gap: 20px;
		flex-wrap: wrap;
	}
	.dashboard-column {
		flex: 1;
		min-width: 300px;
	}
	.dashboard-box {
		border: 2px solid #4d93d9;
		background-color: #f1f8ff;
		padding: 15px;
		margin-bottom: 20px;
	}
	table {
		width: 100%;
		border-collapse: collapse;
		font-size: 0.9em;
	}
	th, td {
		border: 1px solid #ccc;
		padding: 5px;
		text-align: center;
	}
	th {
		background-color: #4d93d9;
		color: #fff;
	}
		.finished-row {
		background-color: #e0e0e0;
		text-decoration: underline;
	}
	/* Migaja de pan para el filtro de meses */
	.month-filter {
		margin-bottom: 15px;
	}
	.month-filter ul {
		list-style: none;
		padding: 0;
		display: flex;
		gap: 10px;
	}
	.month-filter a {
		text-decoration: none;
		color: #333;
	}
	.month-filter a.active {
		font-weight: bold;
		color: #4d93d9;
	}
</style>

<div class="dashboard-container">
  	<h1>Plan de Mantenimiento - {{ asset.name }} ({{ asset.abbreviation }})</h1>
  	{% if filter_year and filter_month %}
    	<h4>{{ filter_month }}/ {{ filter_year }}</h4>
  	{% else %}
		<h4>Resumen del Período: {{ plans.first.period_start }} a {{ plans.first.period_end }}</h3>
	{% endif %}
  	<p><a href="{% url 'mto:plan-report' asset.abbreviation %}">Ver detalle</a></p>

  	<div class="dashboard-columns dashboard-box">


		<!-- Migaja de pan para filtrar por mes -->
		<div class="">
			<nav>
				<ul style="list-style: none; padding: 0; display: flex; gap: 10px;">
					<li><a href="?">Todos</a></li>
					{% for y, m, label, param in months %}
					<li>
						<a href="?month={{ param }}" {% if filter_year == y and filter_month == m %} style="font-weight:bold; color:#4d93d9;" {% endif %}>
							{{ label }}
						</a>
					</li>
					{% endfor %}
				</ul>
			</nav>
		</div>

    	<!-- Columna para Resumen de Rutinas -->
    	<div class="dashboard-column">
      		<div class="">
        		<h3>Resumen de Rutinas</h3>
				<table>
					<thead>
						<tr>
							<th>Rutina</th>
							<th>Nivel</th>
							<th>Planificado</th>
							<th>Ejecutado</th>
						</tr>
					</thead>
					<tbody>
						{% for row in routine_rows %}
							<tr {% if row.finished %}class="finished-row"{% endif %}>
								<td>{{ row.routine_name }}</td>
								<td>{{ row.level }}</td>
								<td>{{ row.planned }}</td>
								<td>{{ row.actual }}</td>
							</tr>
						{% empty %}
							<tr>
								<td colspan="4">No se encontraron rutinas para el período.</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
    	
		<!-- Columna para Resumen de Requerimientos -->
    	<div class="dashboard-column">
			<div class="">
				<h3>Resumen de Requerimientos</h3>
				<table>
					<thead>
						<tr>
							<th>Requerimiento</th>
							<th>Total Requerido</th>
							<th>Inventario</th>
						</tr>
					</thead>
					<tbody>
						{% for req in requirements_summary %}
							<tr>
								<td>{{ req.name }}</td>
								<td>{{ req.total_required }}</td>
								<td>
									{% if req.suministro_quantity %}
									{{ req.suministro_quantity }}
									{% else %}
									-
									{% endif %}
								</td>
							</tr>
						{% empty %}
							<tr>
								<td colspan="4">No se encontraron requerimientos para el período.</td>
							</tr>
						{% endfor %}
					</tbody>
		  		</table>
      		</div>
    	</div>
  	</div>
</div>
{% endblock %}
