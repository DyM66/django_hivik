{% extends "got/base/base_pdf.html" %}
{% load my_tags %}

{% block headtag %}
  {{ block.super }}
  <!-- Cargar estilos adicionales (por ejemplo, AOS si lo deseas) -->
  <link rel="stylesheet" href="https://hivik.s3.us-east-2.amazonaws.com/static/css/aos.css">
  <style>
      /* Fuerza el mismo fondo que en la vista HTML */
      body {
          background: url("https://hivik.s3.us-east-2.amazonaws.com/static/Imagen1.jpg") no-repeat center center fixed;
          background-size: cover;
      }
      /* Estilos para la sección de presentación */
      .presentation-section {
          display: flex;
          justify-content: center;
          align-items: center;
          height: 80vh;
          text-align: center;
          background: rgba(0,0,0,0.5);
          margin-bottom: 50px;
      }
      .presentation-section h1 {
          font-size: 64px;
          color: #fff;
      }
      /* Estilos para cada sección de asset */
      .asset-section {
          padding: 80px 50px;
          border-bottom: 2px solid rgba(0,0,0,0.2);
          margin-bottom: 50px;
          background: rgba(255,255,255,0.9);
      }
      .asset-title {
          font-size: 42px;
          font-weight: bold;
          color: #000;
      }
      .compliance-indicator {
          font-size: 20px;
          color: #000;
      }
      /* Estilos para la tabla de solicitudes */
      .solicitudes-table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 20px;
          background: #fff;
          box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      }
      .solicitudes-table th, .solicitudes-table td {
          padding: 10px;
          border: 1px solid #ccc;
          font-size: 14px;
          text-align: left;
      }
  </style>
{% endblock headtag %}

{% block content %}
<div class="container">
    <!-- Sección de presentación -->
    <section id="presentation" class="presentation-section">
        <div>
            <h1>Mantenimiento</h1>
            <p style="font-size:24px; color:#fff;">{{ current_date }}</p>
        </div>
    </section>

    <!-- Por cada asset con OT en ejecución -->
    {% for data in assets_data %}
    <section id="asset-{{ data.asset.abbreviation }}" class="asset-section">
        <div>
            <h2 class="asset-title">
                {{ data.asset.name }} 
                <span class="compliance-indicator">({{ data.compliance }}%)</span>
            </h2>
        </div>
        {# Aquí puedes incluir el contenido que desees replicar, por ejemplo: #}
        <h3>Solicitudes</h3>
        <table class="solicitudes-table">
            <thead>
                <tr>
                    <th>Cotización</th>
                    <th>#SC</th>
                    <th>Total</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody>
                {# Solicitudes individuales #}
                {% for sol in data.individual_solicitudes %}
                <tr>
                    <td>
                        {% if sol.ot %}
                            {{ sol.ot.description }} - {{ sol.quotation }}
                        {% else %}
                            {{ sol.cotizacion }}
                        {% endif %}
                    </td>
                    <td>{% if sol.num_sc %}{{ sol.num_sc }}{% else %}-{% endif %}</td>
                    <td>{{ sol.total|currency }}</td>
                    <td>{{ sol.estado }}</td>
                </tr>
                {% endfor %}
                {# Solicitudes agrupadas #}
                {% for group in data.grouped_solicitudes %}
                <tr>
                    <td>{{ group.ot_description }} ({{ group.count }})</td>
                    <td>{{ group.sc_numbers|join:", " }}</td>
                    <td>{{ group.subtotal|currency }}</td>
                    <td>-</td>
                </tr>
                {% endfor %}
                <tr>
                    <td colspan="2" style="text-align: right;"><strong>Total General:</strong></td>
                    <td><strong>{{ data.overall_total|currency }}</strong></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </section>
    {% endfor %}

    <!-- Sección para assets sin OT -->
    <section id="assets-no-ot" class="asset-section">
        <h2 class="asset-title" style="color:#000;">Resumen de Activos Sin OT en Ejecución</h2>
        <ul>
            {% for asset in assets_no_ot %}
                <li>{{ asset.name }} - Cumplimiento: {{ asset.maintenance_compliance_cache }}%</li>
            {% empty %}
                <li>No hay activos sin OT.</li>
            {% endfor %}
        </ul>
    </section>
</div>
{% endblock content %}
